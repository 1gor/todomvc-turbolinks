<section id="todoapp">
  <header id="header" data-turbolinks-permanent>
    <h1>todos</h1>
    <%= form_for Todo.new, remote: true do |f| %>
      <%= f.text_field :title, id: "new-todo", placeholder: "What needs to be done?", autofocus: true, autocomplete: "off" %>
    <% end %>
  </header>
  <section id="main" class="<%= "hidden" unless @todos.any? || filtering_params.any? %>">
    <%= form_tag update_many_todos_path, method: :put, remote: true, "data-turbolinks-temporary" => true, id: "update_many_todos" do %>
      <% @todos.map do |todo| %>
        <%= hidden_field_tag "ids[]", todo.id %>
      <% end %>
      <%= check_box :todo, :is_completed, checked: @todos.all?(&:is_completed), id: "toggle-all", "data-behavior": "submit_on_check" %>
      <label for="toggle-all">Mark all as complete</label>
    <% end %>
    <ul id="todos">
      <%= render @todos %>
    </ul>
  </section>
  <footer id="footer" data-turbolinks-temporary class="<%= "hidden" unless @todos.any? || filtering_params.any? %>">
    <span id="todo-count">
      <%= pluralize @todos.reject(&:is_completed).size, "item" %> left
    </span>
    <ul id="filters">
      <li>
        <a id="all" href="/" class="<%= "selected" if request.fullpath == '/' || request.fullpath == "/todos" %>">All</a>
      </li>
      <li>
        <a id="active" href="/?completed=false" class="<%= "selected" if request.fullpath.match("completed=false") %>">Active</a>
      </li>
      <li>
        <a id="completed" href="/?completed=true" class="<%= "selected" if request.fullpath.match("completed=true") %>">Completed</a>
      </li>
    </ul>
    <% if @todos.select { |t| t.is_completed }.size > 0 %>
      <%= form_tag destroy_many_todos_path, remote: true, method: :delete do %>
        <% @todos.select { |t| t.is_completed }.map do |todo| %>
          <%= hidden_field_tag "ids[]", todo.id %>
        <% end %>
        <%= button_tag "Clear completed", id: "clear-completed" %>
      <% end %>
    <% end %>
  </footer>
</section>
